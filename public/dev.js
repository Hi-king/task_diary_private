// Generated by CoffeeScript 1.6.3
(function() {
  var toYYMMDD;

  toYYMMDD = function(date) {
    var dd, mm, yy;
    yy = ("" + (date.getFullYear())).slice(-2);
    mm = ("00" + (date.getMonth() + 1)).slice(-2);
    dd = ("00" + (date.getDay() + 1)).slice(-2);
    return yy + mm + dd;
  };

  $(function() {
    return d3.tsv('/worklog.tsv', function(error, data) {
      var $schedule, datestr, rows, schedule, schedule_ary, values;
      schedule_ary = {};
      data.map(function(item) {
        item.start = new Date(item.start);
        return item.end = new Date(item.end);
      });
      data.forEach(function(item) {
        return schedule_ary[toYYMMDD(item.start)] = [];
      });
      data.forEach(function(item) {
        return schedule_ary[toYYMMDD(item.start)].push(item);
      });
      console.log(schedule_ary);
      rows = [];
      for (datestr in schedule_ary) {
        values = schedule_ary[datestr];
        console.log(datestr);
        console.log(values);
        schedule = values.map(function(data) {
          return {
            start: data.start.toLocaleTimeString().slice(0, 6),
            end: data.end.toLocaleTimeString().slice(0, 6),
            text: data.event,
            data: {}
          };
        });
        values.forEach(function(data) {
          return console.log("" + (data.start.toLocaleTimeString().slice(0, 6)) + " - " + (data.end.toLocaleTimeString().slice(0, 6)));
        });
        rows.push({
          title: datestr,
          schedule: schedule
        });
        console.log(schedule);
      }
      return $schedule = $("#schedule").timeSchedule({
        startTime: "10:00",
        endTime: "24:00",
        widthTime: 300,
        timeLineY: 60,
        verticalScrollbar: 20,
        timeLineBorder: 2,
        debug: "#debug",
        rows: rows
      });
    });
  });

}).call(this);
